<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Font Sampler Demo</title>
    <link rel="stylesheet" href="https://nikita-kanarev.github.io/fontsampler-skin.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
            background: #fafafa;
        }
        
        .section {
            background: white;
            margin: 30px 0;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .section h2 {
            color: #333;
            margin-top: 0;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 10px;
        }
        
        .font-examples {
            display: grid;
            gap: 20px;
            margin-top: 20px;
        }
        
        .font-examples > div {
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #007bff;
        }
        
        .tester-container {
            border: 2px dashed #ddd;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .description {
            color: #666;
            font-size: 14px;
            margin-bottom: 20px;
            padding: 15px;
            background: #e3f2fd;
            border-radius: 6px;
        }
    </style>
</head>
<body>
    <h1>Демонстрация Font Sampler</h1>
    
    <div class="section">
        <h2>Inter Variable - Интерактивный тестер</h2>
        <div class="description">
            Полнофункциональный тестер с настройкой всех осей (Weight, Optical Size, Slant) и OpenType функций
        </div>
        <div class="tester-container">
            <div id="sampler_font1" 
                 data-mode="tester"
                 data-font-url="https://nikita-kanarev.github.io/InterVariable.woff2"
                 data-font-name="Inter Variable"
                 data-variable-axes="wght:100:900:1:Weight,opsz:8:36:1:Optical Size,slnt:-15:0:1:Slant"
                 data-opentype-features="kern:Kerning:true,liga:Ligatures:true,calt:Contextual Alternates:true,ss01:Stylistic Set 1:false,ss02:Stylistic Set 2:false"
                 data-order="wght,opsz,slnt|opentype|tester">Variations example with dynamic axes</div>
        </div>
    </div>

    <div class="section">
        <h2>Inter Variable - Примеры начертаний</h2>
        <div class="description">
            Фиксированные примеры различных начертаний того же шрифта в режиме только для чтения
        </div>
        <div class="font-examples">
            <div id="sampler_FontName_1" 
                 data-mode="readonly" 
                 data-font-url="https://nikita-kanarev.github.io/InterVariable.woff2"
                 data-axes="wght:100,opsz:32">Тонкое начертание (Weight: 100, Optical Size: 32)</div>
            
            <div id="sampler_FontName_2" 
                 data-mode="readonly" 
                 data-font-url="https://nikita-kanarev.github.io/InterVariable.woff2"
                 data-axes="wght:400,opsz:14">Обычное начертание (Weight: 400, Optical Size: 14)</div>
                 
            <div id="sampler_FontName_3" 
                 data-mode="readonly" 
                 data-font-url="https://nikita-kanarev.github.io/InterVariable.woff2"
                 data-axes="wght:700,opsz:18">Жирное начертание (Weight: 700, Optical Size: 18)</div>
                 
            <div id="sampler_FontName_4" 
                 data-mode="readonly" 
                 data-font-url="https://nikita-kanarev.github.io/InterVariable.woff2"
                 data-axes="wght:900,opsz:8">Сверхжирное начертание (Weight: 900, Optical Size: 8)</div>
        </div>
    </div>

    <div class="section">
        <h2>Over Variable - Интерактивный тестер</h2>
        <div class="description">
            Второй вариативный шрифт с собственными настройками осей
        </div>
        <div class="tester-container">
            <div id="sampler_font2" 
                 data-mode="tester"
                 data-font-url="https://nikita-kanarev.github.io/OverVariable.woff2"
                 data-font-name="Over Variable"
                 data-variable-axes="wght:10:90:1:Weight,opsz:10:30:1:Optical Size"
                 data-opentype-features="kern:Kerning:true,liga:Ligatures:true"
                 data-order="wght,opsz|opentype|tester">Variations2 example2 with2 dynamic2 axes</div>
        </div>
    </div>

    <div class="section">
        <h2>Over Variable - Примеры начертаний</h2>
        <div class="description">
            Демонстрация различных настроек второго вариативного шрифта
        </div>
        <div class="font-examples">
            <div id="sampler_OverFontName_1" 
                 data-mode="readonly" 
                 data-font-url="https://nikita-kanarev.github.io/OverVariable.woff2"
                 data-axes="wght:20,opsz:25">Легкое начертание (Weight: 20, Optical Size: 25)</div>
                 
            <div id="sampler_OverFontName_2" 
                 data-mode="readonly" 
                 data-font-url="https://nikita-kanarev.github.io/OverVariable.woff2"
                 data-axes="wght:50,opsz:15">Средне начертание (Weight: 50, Optical Size: 15)</div>
                 
            <div id="sampler_OverFontName_3" 
                 data-mode="readonly" 
                 data-font-url="https://nikita-kanarev.github.io/OverVariable.woff2"
                 data-axes="wght:80,opsz:10">Жирное начертание (Weight: 80, Optical Size: 10)</div>
        </div>
    </div>

    <div class="section">
        <h2>Базовые самплеры</h2>
        <div class="description">
            Простые демонстрации шрифтов с минимальным интерфейсом
        </div>
        <div class="font-examples">
            <div id="sampler_basic_1" 
                 data-font-url="https://nikita-kanarev.github.io/InterVariable.woff2"
                 data-axes="wght:300,opsz:20"
                 data-fontsize-init="48">Базовый самплер Inter Variable</div>
                 
            <div id="sampler_basic_2" 
                 data-font-url="https://nikita-kanarev.github.io/OverVariable.woff2"
                 data-axes="wght:40,opsz:20"
                 data-fontsize-init="48">Базовый самплер Over Variable</div>
        </div>
    </div>

    <!-- Подключение скриптов -->
    <script src="https://nikita-kanarev.github.io/fontsampler.js"></script>
    <script src="https://nikita-kanarev.github.io/fontsampler-skin.js"></script>
    
    <script>
        // Динамическое создание fontFiles из data-атрибутов
        function createFontFiles() {
            const fontMap = new Map();
            
            document.querySelectorAll('[data-font-url]').forEach(el => {
                const fontUrl = el.dataset.fontUrl;
                const fontName = el.dataset.fontName || extractFontNameFromUrl(fontUrl);
                
                if (!fontMap.has(fontName)) {
                    fontMap.set(fontName, {
                        name: fontName,
                        files: [fontUrl]
                    });
                }
            });
            
            return Array.from(fontMap.values());
        }
        
        // Извлечение имени шрифта из URL если data-font-name не указано
        function extractFontNameFromUrl(url) {
            const filename = url.split('/').pop().split('?')[0];
            return filename.replace(/\.(woff2?|otf|ttf)$/i, '').replace(/([A-Z])/g, ' $1').trim();
        }
        
        const fontFiles = createFontFiles();

        // Парсинг data-axes="wght:500,opsz:14" → { wght: 500, opsz: 14 }
        function parseAxes(string) {
            const axes = {};
            if (!string) return axes;
            string.split(',').forEach(pair => {
                const [key, val] = pair.split(':');
                axes[key.trim()] = parseFloat(val);
            });
            return axes;
        }

        // Парсинг переменных осей: "wght:100:900:1:Weight,opsz:8:36:1:Optical Size"
        function parseVariableAxes(string) {
            const axes = {};
            if (!string) return axes;
            
            string.split(',').forEach(axisData => {
                const parts = axisData.split(':');
                if (parts.length >= 4) {
                    const [tag, min, max, step, ...labelParts] = parts;
                    axes[tag.trim()] = {
                        min: parseFloat(min),
                        max: parseFloat(max), 
                        step: parseFloat(step),
                        init: parseFloat(min) + (parseFloat(max) - parseFloat(min)) / 2, // Среднее значение по умолчанию
                        label: labelParts.join(':') || tag.trim()
                    };
                }
            });
            return axes;
        }

        // Парсинг OpenType функций: "kern:Kerning:true,liga:Ligatures:false"
        function parseOpenTypeFeatures(string) {
            const features = {
                label: "",
                init: [],
                choices: []
            };
            
            if (!string) return features;
            
            string.split(',').forEach(featureData => {
                const parts = featureData.split(':');
                if (parts.length >= 3) {
                    const [tag, label, defaultActive] = parts;
                    const tagTrimmed = tag.trim();
                    const labelTrimmed = label.trim();
                    const isActive = defaultActive.trim().toLowerCase() === 'true';
                    
                    features.choices.push(`${tagTrimmed}|${labelTrimmed}`);
                    if (isActive) {
                        features.init.push(tagTrimmed);
                    }
                }
            });
            
            return features;
        }

        // Парсинг order из data-order="wght,opsz|fontsize|opentype|tester"
        function parseOrder(string) {
            if (!string) return [["fontsize"], "tester"];
            
            return string.split('|').map(group => {
                if (group.includes(',')) {
                    return group.split(',').map(item => item.trim());
                }
                return group.trim();
            });
        }

        // Получение параметра из data-атрибутов с fallback значением
        function getDataParam(el, param, fallback) {
            const value = el.dataset[param];
            if (value === undefined) return fallback;
            
            const num = parseFloat(value);
            if (!isNaN(num)) return num;
            
            return value;
        }

        // Построение конфига для обычного параметра
        function buildParamConfig(el, paramName, defaults = {}) {
            const config = {};
            const properties = ['init', 'min', 'max', 'step', 'unit', 'label'];
            
            properties.forEach(prop => {
                const dataKey = `${paramName}${prop.charAt(0).toUpperCase() + prop.slice(1)}`;
                const value = el.dataset[dataKey];
                
                if (value !== undefined) {
                    const num = parseFloat(value);
                    config[prop] = !isNaN(num) ? num : value;
                } else if (defaults[prop] !== undefined) {
                    config[prop] = defaults[prop];
                }
            });
            
            return Object.keys(config).length > 0 ? config : defaults;
        }

        // Главный цикл по всем элементам с data-font-url
        document.querySelectorAll('[data-font-url]').forEach((el) => {
            const mode = el.dataset.mode || "default";
            const axes = parseAxes(el.dataset.axes);
            
            // Демонстрация шрифта — readonly
            if (mode === "readonly") {
                const sampler = new Fontsampler(el, fontFiles, {
                    order: [],
                    config: {
                        fontsize: { 
                            init: getDataParam(el, 'fontsizeInit', 36),
                            min: getDataParam(el, 'fontsizeMin', 20),
                            max: getDataParam(el, 'fontsizeMax', 500),
                            unit: getDataParam(el, 'fontsizeUnit', "px")
                        },
                        wght: { init: axes.wght || getDataParam(el, 'wghtInit', 200) },
                        opsz: { init: axes.opsz || getDataParam(el, 'opszInit', 14) },
                        tester: {
                            editable: false,
                            label: false
                        }
                    }
                });
                sampler.init();
                return;
            }
            
            // Тестер вариативного шрифта — динамический UI
            if (mode === "tester") {
                const order = parseOrder(el.dataset.order);
                const variableAxes = parseVariableAxes(el.dataset.variableAxes);
                const openTypeFeatures = parseOpenTypeFeatures(el.dataset.opentypeFeatures);
                
                // Начинаем с базового конфига
                const config = {
                    fontsize: buildParamConfig(el, 'fontsize', { 
                        init: 100, min: 20, max: 500, step: 1, unit: "px", label: "Size" 
                    })
                };
                
                // Добавляем динамические оси
                Object.keys(variableAxes).forEach(axisTag => {
                    config[axisTag] = variableAxes[axisTag];
                });
                
                // Добавляем OpenType функции, если они есть
                if (openTypeFeatures.choices.length > 0) {
                    config.opentype = openTypeFeatures;
                }
                
                const sampler = new Fontsampler(el, fontFiles, {
                    order: order,
                    config: config
                });
                FontsamplerSkin(sampler);
                sampler.init();
                return;
            }
            
            // Самплеры — тихий режим (только стили из data-axes)
            const sampler = new Fontsampler(el, fontFiles, {
                multiline: false,
                order: [["fontsize"]],
                config: {
                    wght: { init: axes.wght || 400 },
                    opsz: { init: axes.opsz || 14 },
                    fontsize: { 
                        init: getDataParam(el, 'fontsizeInit', 200),
                        min: getDataParam(el, 'fontsizeMin', 20), 
                        max: getDataParam(el, 'fontsizeMax', 500),
                        step: getDataParam(el, 'fontsizeStep', 1), 
                        unit: getDataParam(el, 'fontsizeUnit', "px"), 
                        label: getDataParam(el, 'fontsizeLabel', "Size")
                    }
                }
            });
            FontsamplerSkin(sampler);
            sampler.init();
        });
    </script>
</body>
</html>