<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Fontsampler - Упрощенная версия</title>
  <script src="https://nikita-kanarev.github.io/fontsampler.js"></script>
  <script src="https://nikita-kanarev.github.io/fontsampler-skin.js"></script>
  <link rel="stylesheet" href="https://nikita-kanarev.github.io/fontsampler-skin.css">
  <style>
    /* Примеры начертаний в одну строку */
    .font-examples {
      display: flex;
      gap: 20px;
      margin: 20px 0;
      flex-wrap: wrap;
    }
    
    .font-examples > div {
      flex: 0 0 auto;
    }
    
    .readonly .fsjs-block-tester {
      white-space: nowrap !important;
    }
  </style>
</head>
<body>

<!-- Главный тестер -->
<div id="tester" 
     data-mode="tester"
     data-axes="wght:100:900,opsz:8:36,slnt:-15:0"
     data-features="kern,liga,calt"
     data-size="160">Variations example with dynamic axes</div>

<!-- Примеры начертаний -->
<div class="font-examples">
  <div data-wght="100" data-opsz="32">Тонкое</div>
  <div data-wght="400" data-opsz="20">Обычное</div>
  <div data-wght="700" data-opsz="14">Жирное</div>
  <div data-wght="900" data-opsz="12">Сверхжирное</div>
</div>

<script>
const fontFiles = [{
  name: "Inter Variable",
  files: ["https://nikita-kanarev.github.io/InterVariable.woff2"]
}];

// Универсальная функция парсинга
function parseData(str, separator = ',', pairSeparator = ':') {
  if (!str) return {};
  return Object.fromEntries(
    str.split(separator).map(pair => {
      const [key, ...values] = pair.split(pairSeparator);
      return [key.trim(), values.length === 1 ? parseFloat(values[0]) || values[0] : values];
    })
  );
}

// Инициализация всех сэмплеров
document.querySelectorAll('[id], [data-wght], [data-opsz]').forEach(el => {
  const mode = el.dataset.mode;
  const size = parseInt(el.dataset.size) || 60;
  
  // Базовый конфиг
  const config = {
    fontsize: { init: size, min: 20, max: 500 },
    wght: { init: parseInt(el.dataset.wght) || 400 },
    opsz: { init: parseInt(el.dataset.opsz) || 14 },
    tester: { 
      editable: mode === 'tester',
      label: mode === 'tester'
    }
  };
  
  let order = [];
  
  // Если это главный тестер
  if (mode === 'tester') {
    const axes = parseData(el.dataset.axes);
    const features = el.dataset.features?.split(',') || [];
    
    // Добавляем оси как слайдеры
    Object.entries(axes).forEach(([axis, range]) => {
      const [min, max] = range.toString().split(':').map(Number);
      config[axis] = { 
        min, 
        max, 
        init: min + (max - min) * 0.3,
        step: 1 
      };
    });
    
    // Добавляем OpenType фичи
    if (features.length) {
      config.opentype = {
        init: features.slice(0, 2), // включаем первые 2 по умолчанию
        choices: features.map(f => `${f}|${f.toUpperCase()}`)
      };
    }
    
    order = [Object.keys(axes), 'fontsize', features.length ? 'opentype' : null, 'tester'].filter(Boolean);
  } else {
    // Простые readonly примеры
    order = [];
    el.classList.add('readonly');
  }
  
  const sampler = new Fontsampler(el, fontFiles, { order, config });
  
  if (mode === 'tester') FontsamplerSkin(sampler);
  sampler.init();
});
</script>
</body>
</html>